version: '3'
services:

  pandoc:
    image: t3docs/wiki-migration
    build: ./pandoc

  composer-install:
    image: t3docs/wiki-migration
    user: "${UID}:${GID}"
    volumes:
      - .:/wiki-migration
    environment:
      SCRIPT_VERBOSE: 0
    command: >
      /bin/sh -c '
        [ "$${SCRIPT_VERBOSE}" -eq "1" ] && set -x;
        cd php && composer install;
      '

  composer-update:
    image: t3docs/wiki-migration
    user: "${UID}:${GID}"
    volumes:
      - .:/wiki-migration
    environment:
      SCRIPT_VERBOSE: 0
    command: >
      /bin/sh -c '
        [ "$${SCRIPT_VERBOSE}" -eq "1" ] && set -x;
        cd php && composer update;
      '

  convert:
    image: t3docs/wiki-migration
    user: "${UID}:${GID}"
    volumes:
      - .:/wiki-migration
    environment:
      SCRIPT_VERBOSE: 0
    command: >
      /bin/sh -c '
        [ "$${SCRIPT_VERBOSE}" -eq "1" ] && set -x;
        ./php/vendor/bin/wiki;
      '
